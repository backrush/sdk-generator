const { Command } = require("commander");
const inquirer = require("inquirer");
const { globalConfig } = require("../config");
const { actionRunner, success } = require("../parser");
const { questionsLogin } = require("../questions");
const { sdkForConsole } = require("../sdks");
const { accountCreateSession, accountDeleteSession } = require("./account");

const login = new Command("login")
    .description("Login to your account")
    .action(actionRunner (async () => {
        const answers = await inquirer.prompt(questionsLogin)

        let client = await sdkForConsole(false);
        
        await accountCreateSession({
            email: answers.email,
            password: answers.password,
            parseOutput: false,
            sdk: client
        })
        
        success()
    }));

const logout = new Command("logout")
    .description("Logout from your Appwrite account")
    .action(actionRunner (async () => {
        let client = await sdkForConsole();

        await accountDeleteSession({
            sessionId: 'current',
            parseOutput: false,
            sdk: client
        })

        globalConfig.setCookie("");
        success()
    }));

module.exports = {
    login,
    logout,
};
