package {{ sdk.namespace | caseDot }}

class Query(
    val method: String
    val attribute: String? = null,
    val values: List<Any>? = null,
) {
    override fun toString() = gson.toJson(this)

    companion object {
        private val gson = Gson()

        fun equal(attribute: String, value: Any) = Query("equal", attribute, parseValue(value))

        fun notEqual(attribute: String, value: Any) = Query("notEqual", attribute, listOf(value))

        fun lessThan(attribute: String, value: Any) = Query("lessThan", attribute, listOf(value))

        fun lessThanEqual(attribute: String, value: Any) = Query("lessThanEqual", attribute, listOf(value))

        fun greaterThan(attribute: String, value: Any) = Query("greaterThan", attribute, listOf(value))

        fun greaterThanEqual(attribute: String, value: Any) = Query("greaterThanEqual", attribute, listOf(value))

        fun search(attribute: String, value: String) = Query("search", attribute, listOf(value))

        fun isNull(attribute: String) = Query("isNull", attribute)

        fun isNotNull(attribute: String) = Query("isNotNull", attribute)

        fun between(attribute: String, start: Any, end: Any) = Query("between", attribute, listOf(start, end))

        fun startsWith(attribute: String, value: String) = Query("startsWith", attribute, listOf(value))

        fun endsWith(attribute: String, value: String) = Query("endsWith", attribute, listOf(value))

        fun select(attributes: List<String>) = Query("select", null, attributes)

        fun orderAsc(attribute: String) = Query("orderAsc", attribute)

        fun orderDesc(attribute: String) = Query("orderDesc", attribute)

        fun cursorBefore(documentId: String) = Query("cursorBefore", null, listOf(documentId))

        fun cursorAfter(documentId: String) = Query("cursorAfter", null, listOf(documentId))

        fun limit(limit: Int) = Query("limit", null, listOf(limit))

        fun offset(offset: Int) = Query("offset", null, listOf(offset))

        fun contains(attribute: String, value: Any) = Query("contains", attribute, parseValue(value))

        fun or(queries: List<Query>) = Query("or", null, queries)

        private fun parseValue(value: Any): Any {
            return when (value) {
                is List<*> -> value
                else -> listOf(value)
            }
        }
    }
}