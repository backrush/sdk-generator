using System.Collections;
using System.Collections.Generic;
using System.Linq;
using Newtonsoft.Json;


namespace Appwrite
{
    public static class Query
    {
        public string method;
        public string? attribute;
        public object? values;

        override public string ToString()
        {
            return JsonConvert.SerializeObject(this);
        }

        public static Query Equal(string attribute, object value)
        {
            return BuildQuery("equal", attribute, value);
        }

        public static Query NotEqual(string attribute, object value)
        {
            return BuildQuery("notEqual", attribute, value);
        }

        public static Query LessThan(string attribute, object value)
        {
            return BuildQuery("lessThan", attribute, value);
        }

        public static Query LessThanEqual(string attribute, object value)
        {
            return BuildQuery("lessThanEqual", attribute, value);
        }

        public static Query GreaterThan(string attribute, object value)
        {
            return BuildQuery("greaterThan", attribute, value);
        }

        public static Query GreaterThanEqual(string attribute, object value)
        {
            return BuildQuery("greaterThanEqual", attribute, value);
        }

        public static Query Search(string attribute, string value)
        {
            return BuildQuery("search", attribute, value);
        }

        public static Query IsNull(string attribute)
        {
            return BuildQuery("isNull", attribute, null);
        }

        public static Query IsNotNull(string attribute)
        {
            return BuildQuery("isNotNull", attribute, null);
        }

        public static Query StartsWith(string attribute, string value)
        {
            return BuildQuery("startsWith", attribute, value);
        }

        public static Query EndsWith(string attribute, string value)
        {
            return BuildQuery("endsWith", attribute, value);
        }

        public static Query Between(string attribute, string start, string end)
        {
            return BuildQuery("between", attribute, new List<string> { start, end });
        }

        public static Query Between(string attribute, int start, int end)
        {
            return BuildQuery("between", attribute, new List<int> { start, end });
        }

        public static Query Between(string attribute, double start, double end)
        {
            return BuildQuery("between", attribute, new List<double> { start, end });
        }

        public static Query Select(List<string> attributes)
        {
            return BuildQuery("select", null, attributes);
        }

        public static Query CursorAfter(string documentId)
        {
            return BuildQuery("cursorAfter", null, documentId);
        }

        public static Query CursorBefore(string documentId) {
            return BuildQuery("cursorBefore", null, documentId);
        }

        public static Query OrderAsc(string attribute) {
            return BuildQuery("orderAsc", attribute, null);
        }

        public static Query OrderDesc(string attribute) {
            return BuildQuery("orderDesc", attribute, null);
        }

        public static Query Limit(int limit) {
            return BuildQuery("limit", null, limit);
        }

        public static Query Offset(int offset) {
            return BuildQuery("offset", null, offset);
        }

        public static Query Or(List<Query> queries) {
            return BuildQuery("or", null, queries);
        }

        private static BuildQuery(string method, string? attribute, object? value)
        {
            if (value != null && !(value is IList))
            {
                value = new List<object> { value };
            }

            return new Query
            {
                method = method,
                attribute = attribute,
                values = value
            };
        }
    }
}