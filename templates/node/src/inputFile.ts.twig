import { File } from "node-fetch-native";
import { BinaryLike } from "crypto";

export class InputFile {
  static fromBlob(blob: Blob, name: string): File {
    return new File([blob], name);
  }

  static fromBuffer(
    parts: BinaryLike,
    name: string
  ): File {
    return new File([parts], name);
  }

  static fromPath(path: string, name: string): File {
    // @ts-ignore
    if (typeof globalThis.EdgeRuntime !== 'string') {
      const { realpathSync, readFileSync } = require('fs');
      const realPath = realpathSync(path);
      const contents = readFileSync(realPath);
      return this.fromBuffer(contents, name);
    }

    throw new Error('node:fs is not available in edge runtimes');
  }

  static fromPlainText(content: string, name: string): File {
    const arrayBytes = new TextEncoder().encode(content);
    return this.fromBuffer(arrayBytes, name);
  }
}
