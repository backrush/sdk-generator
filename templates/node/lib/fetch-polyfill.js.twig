const fetch = typeof globalThis.fetch === 'undefined' 
    ? require('undici').fetch
    : globalThis.fetch;

const FormData = typeof globalThis.FormData === 'undefined' 
    ? require('undici').FormData
    : globalThis.FormData;

const File = typeof globalThis.File === 'undefined' 
    ? require('undici').File
    : globalThis.File;

/** @type {(selfSigned: boolean) => import('undici').Agent|undefined} */
let dispatcher = (_selfSigned) => undefined;

if (typeof globalThis.EdgeRuntime !== 'string') {
    const Agent = require('undici').Agent;
    dispatcher = (selfSigned) => new Agent({
        connect: {
            rejectUnauthorized: !selfSigned,
        }
    });
}

function buildNodeUserAgent() {
    const os = require('os');
    return `{{spec.title | caseUcfirst}}{{language.name | caseUcfirst}}SDK/{{ sdk.version }} (${os.type()}; ${os.version()}; ${os.arch()})`;
}

const USER_AGENT = typeof globalThis.EdgeRuntime === 'string' ? `{{spec.title | caseUcfirst}}{{language.name | caseUcfirst}}SDK/{{ sdk.version }}` : buildNodeUserAgent();


module.exports = {
    fetch,
    FormData,
    File,
    dispatcher,
    USER_AGENT
}