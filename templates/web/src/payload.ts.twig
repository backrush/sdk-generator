export class Payload {
    public fileName?: string;
    public size: number;

    private data: Blob;

    constructor(data: Blob, fileName?: string) {
        this.data = data;
        this.fileName = fileName;
        this.size = data.size;
    }

    public getFileName(): string {
        return this.fileName;
    }

    public async toString(): Promise<string> {
        return await this.data.text();
    }

    public async toJson<T = unknown>(): Promise<T> {
        return JSON.parse(await this.data.text());
    }

    public async toBinary(offset: number = 0, length?: number): Promise<ArrayBuffer> {
        const end = length ? offset + length : this.size;
        return await this.data.slice(offset, end).arrayBuffer();
    }

    public async toFile(fileName?: string): Promise<Blob> {
        return this.data;
    }

    public static fromFile(file: File | Blob, fileName?: string): Payload {
        if (file instanceof File && !fileName) {
            fileName = file.name;
        }
        return new Payload(file, fileName);
    }

    public static fromString(data: string, fileName?: string): Payload {
        return new Payload(new Blob([data]), fileName);
    }

    public static fromJson<T = unknown>(data: T, fileName?: string): Payload {
        return new Payload(new Blob([JSON.stringify(data)]), fileName);
    }

    public static fromBinary(data: ArrayBuffer, fileName?: string): Payload {
        return new Payload(new Blob([data]), fileName);
    }
}