dist: xenial

language: php

php:
  - 7.3

notifications:
  email:
    - team@appwrite.io

services:
  - docker

before_script: composer install

install:
  - >
      echo "localhost\n80\n443\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n" | docker run --rm \
          --volume /var/run/docker.sock:/var/run/docker.sock \
          --volume "$(pwd)"/appwrite:/install/appwrite:rw \
          -e version=0.6.2 \
          appwrite/install
  - sleep 90
  - cat ./appwrite/docker-compose.yml
  - cd ./appwrite
  - docker-compose exec appwrite bash -c 'echo "$_APP_DOMAIN"'
  - docker-compose exec appwrite bash -c 'echo "$_APP_DOMAIN_TARGET"'
  - docker ps
  - cd ..

script:
  - vendor/bin/phpunit
